\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{minutes-lista}[2012/12/03 Tabela minutek dla notatek ze spotkań w ramach projektu PPI 2012/2013]

\RequirePackage{xparse}

\RequirePackage[inline]{enumitem}

\RequirePackage{longtable}
\setlength{\LTpre}{0.5\baselineskip}
%\setlength{\LTpost}{1.0\baselineskip}

\RequirePackage{booktabs}
\DeclareDocumentCommand {\AdjustArrayStretch} { m } {%
    \RenewDocumentCommand {\arraystretch} { } {#1}
}

\RequirePackage{colortbl}

\RequirePackage{xcolor}
\definecolor{black}{gray}{0.0}
\definecolor{light-gray}{gray}{0.8}
\definecolor{blue}{HTML}{268BD2}
\definecolor{green}{HTML}{859900}
\definecolor{red}{HTML}{DC322F}
\definecolor{yellow}{HTML}{B58900}

\NewDocumentCommand {\generictag} { m O{blue} O{white} } {%
    \colorbox{#2}{\color{#3}{\small\bfseries\scshape #1}}
}
\NewDocumentCommand {\todotag} { } {%
    \generictag{TODO}[blue]
}
\NewDocumentCommand {\remarktag} { } {%
    \generictag{Uwaga}[red]
}
\NewDocumentCommand {\ideatag} { } {%
    \generictag{Pomysł}[green]
}
\NewDocumentCommand {\infotag} { } {%
    \generictag{Info}[yellow]
}

\NewDocumentEnvironment {minutes} { } {%
\AdjustArrayStretch{1.2}
\begin{longtable}{@{} p{0.085\textwidth} @{\hspace{0.01\textwidth}} p{0.25\textwidth} @{\hspace{0.02\textwidth}} p{0.115\textwidth} @{\hspace{0.02\textwidth}} p{0.5\textwidth} @{}}
    \arrayrulecolor{black}\toprule[1pt]
    & \textbf{Minutka} & \textbf{Kto} & \textbf{Szczegóły} \tabularnewline
    \arrayrulecolor{black}\toprule[1pt]
    \endfirsthead

    \arrayrulecolor{black}\toprule[1pt]
    & \textbf{Minutka} & \textbf{Kto} & \textbf{Szczegóły} \tabularnewline
    \arrayrulecolor{black}\toprule[1pt]
    \endhead

    %\arrayrulecolor{black}\midrule[0.5pt]
    %\multicolumn{4}{@{} r @{}}{Kontynuacja na następnej stronie.} \tabularnewline
    %\arrayrulecolor{black}\midrule[0.5pt]
    \endfoot

    \endlastfoot
}{%
    \end{NoHyper}
    \end{minipage}
    \tabularnewline
    \arrayrulecolor{light-gray}\bottomrule[0.5pt]
\end{longtable}
}

\NewDocumentCommand {\minute} { s m m O{} } {%
    \IfBooleanTF #1 {%
    }{%
        \end{NoHyper}
        \end{minipage}
        \tabularnewline
        \arrayrulecolor{light-gray}\midrule[0.5pt]
    }%
    {#2} & {#3} & {#4} &
    \begin{minipage}[t]{0.5\textwidth}
    \begin{NoHyper}
}

\NewDocumentCommand {\todo} { s m O{} } {%
    \IfBooleanTF #1 {%
        \minute*{\todotag}{#2}[#3]
    }{%
        \minute{\todotag}{#2}[#3]
    }%
}

\NewDocumentCommand {\remark} { s m O{} } {%
    \IfBooleanTF #1 {%
        \minute*{\remarktag}{#2}[#3]
    }{%
        \minute{\remarktag}{#2}[#3]
    }%
}

\NewDocumentCommand {\idea} { s m O{} } {%
    \IfBooleanTF #1 {%
        \minute*{\ideatag}{#2}[#3]
    }{%
        \minute{\ideatag}{#2}[#3]
    }%
}

\NewDocumentCommand {\info} { s m O{} } {%
    \IfBooleanTF #1 {%
        \minute*{\infotag}{#2}[#3]
    }{%
        \minute{\infotag}{#2}[#3]
    }%
}

\NewDocumentEnvironment {details} { o } {%
    \IfNoValueTF {#1} {%
        \begin{enumerate}[nosep,noitemsep,leftmargin=*]
    }{%
        \begin{enumerate}[#1,nosep,noitemsep,leftmargin=*]
    }%
}{%
    \end{enumerate}
}

\NewDocumentEnvironment {subdetails} { } {%
    \begin{enumerate*}[label=\emph{\alph*})]
}{%
    \end{enumerate*}
}
